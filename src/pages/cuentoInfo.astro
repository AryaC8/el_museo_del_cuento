---
import Layout from '../layouts/Layout.astro';
import Toolbar from '../components/Toolbar.astro';
import ArrowBack from '../../public/icons/arrowBack.astro'
import { db, Cuento, isDbError, like, CuentoDeseado, Categoria, eq } from 'astro:db';

let cuentoElegido
let cuentoNombre: string
let categoriaCuento

if (Astro.request.method === 'POST') { 
  const formData: FormData = await Astro.request.formData();  
  const nombre = formData.get('nombre');   
  const tipoCuento = formData.get('busquedaCuento');    
	try{		
		if (typeof nombre === 'string' && tipoCuento === "Cuento") {	            							
			cuentoElegido = await db.select().from(Cuento).where(eq (Cuento.nombre, nombre));	
			if(cuentoElegido?.length === 0){
				cuentoNombre = "Sin datos"				
			}else{
				cuentoElegido?.map((dato)=>{
					cuentoNombre = dato.nombre					
				})
			}	 			
		}else if(typeof nombre === 'string' && tipoCuento === "CuentoDeseado") { 
			cuentoElegido = await db.select().from(CuentoDeseado).where(eq (CuentoDeseado.nombre, nombre));
			if(cuentoElegido?.length === 0){
				cuentoNombre = "Sin datos"
			}else{
				cuentoElegido?.map((dato)=>{
					cuentoNombre = dato.nombre		
				})
			}						
		}
	}catch(e){
		if (isDbError(e)) {
			return new Response(e);
		}
	}	
}

---
<Layout title= {cuentoNombre}>
	<Toolbar />	
	<section>		
		{cuentoElegido?.map(dato=>{							
			return (			
				<h2 class="text-slate-900 font-extrabold text-2xl sm:text-5xl lg:text-4xl tracking-tight text-center mt-20">{dato.nombre}</h2>
				<article class="grid grid-cols-2 justify-center mt-20 border rounded-md drop-shadow-lg">
					<div class="h-full">
						<div class="h-full">
							<figure class="m-1 h-full">
									<img class="w-11/12 h-full rounded-md mb-1" src= "/cerditos.png" alt={dato.nombre}/>
							</figure> 
						</div>
					</div>
					<div>
						<div class="">
							<h6 class="font-bold text-base mt-1 mx-2">Nombre:</h6>
							<p class="ml-20">{dato.nombre}</p>
						</div>
						<div class="">
							<h6 class="font-bold text-base mt-1 mx-2">Autora o Autor:</h6>
							<p class="ml-20">{dato.autor}</p>
						</div>
						<div class=" ">
							<h6 class="font-bold text-base mt-1 mx-2">Editorial:</h6>
							<p class="ml-20">{dato.editorial}</p>
						</div>
						<div class=" ">
							<h6 class="font-bold text-base mt-1 mx-2">Año:</h6>
							<p class="ml-20">{dato.anyo}</p>
						</div>
						<div class=" ">
							<h6 class="font-bold text-base mt-1 mx-2">Categoría:</h6>
							<p class="ml-20">{dato.categoria}</p>
						</div>
						<div class=" ">
							<h6 class="font-bold text-base mt-1 mx-2">Propiedad de:</h6>
							<p class="ml-20">{dato.anyadidoPor}</p>
						</div>
						 {/* <div class=" ">
							<h6 class="font-bold text-base mt-1 mx-2">Prestado a:</h6>
							<p class="ml-20">{dato.prestadoA}</p>
						</div>  */}
					</div>
				</article>				
			)			
		})}
		<div class="flex flex-wrap justify-center mt-10">
			<span class="flex w-24  hover:bg-green-300 rounded-md">						  
				<a href="/" target="_self" rel="noopener noreferrer nofollow" ><ArrowBack /></a>         
				<a href="/"target="_self" rel="noopener noreferrer nofollow" class="ml-1">Volver</a>
			</span>					
		</div>
	</section>

</Layout>